<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fertility and Fiscal Space – Phi_K advanced tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../../">
<link href="../../../../../../assets/osaa_logo_orange.png" rel="icon" type="image/png">
<script src="../../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../../../assets/osaa_logo_white.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../briefing/briefing.html"> 
<span class="menu-text">Briefing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../article/article.html"> 
<span class="menu-text">Brief</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../dashboard/dashboard.html"> 
<span class="menu-text">Dashboard</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../explorer/explorer.html"> 
<span class="menu-text">Explorer</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-appendix" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Appendix</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-appendix">    
        <li>
    <a class="dropdown-item" href="../../../../../../appendix/eda_report.html">
 <span class="dropdown-text">EDA Report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../appendix/data_yprofile.html">
 <span class="dropdown-text">Data Profile</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../../appendix/data_table.html">
 <span class="dropdown-text">Data Table</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data">Load data</a>
  <ul class="collapse">
  <li><a href="#specify-bin-types" id="toc-specify-bin-types" class="nav-link" data-scroll-target="#specify-bin-types">Specify bin types</a></li>
  </ul></li>
  <li><a href="#phik-correlation-matrix" id="toc-phik-correlation-matrix" class="nav-link" data-scroll-target="#phik-correlation-matrix">Phik correlation matrix</a>
  <ul class="collapse">
  <li><a href="#specify-binning-per-interval-variable" id="toc-specify-binning-per-interval-variable" class="nav-link" data-scroll-target="#specify-binning-per-interval-variable">Specify binning per interval variable</a></li>
  <li><a href="#do-not-apply-noise-correction" id="toc-do-not-apply-noise-correction" class="nav-link" data-scroll-target="#do-not-apply-noise-correction">Do not apply noise correction</a></li>
  <li><a href="#using-a-different-expectation-histogram" id="toc-using-a-different-expectation-histogram" class="nav-link" data-scroll-target="#using-a-different-expectation-histogram">Using a different expectation histogram</a></li>
  </ul></li>
  <li><a href="#statistical-significance-of-the-correlation" id="toc-statistical-significance-of-the-correlation" class="nav-link" data-scroll-target="#statistical-significance-of-the-correlation">Statistical significance of the correlation</a>
  <ul class="collapse">
  <li><a href="#specify-binning-per-interval-variable-1" id="toc-specify-binning-per-interval-variable-1" class="nav-link" data-scroll-target="#specify-binning-per-interval-variable-1">Specify binning per interval variable</a></li>
  <li><a href="#specify-significance-method" id="toc-specify-significance-method" class="nav-link" data-scroll-target="#specify-significance-method">Specify significance method</a></li>
  <li><a href="#simulation-method" id="toc-simulation-method" class="nav-link" data-scroll-target="#simulation-method">Simulation method</a></li>
  <li><a href="#expected-frequencies" id="toc-expected-frequencies" class="nav-link" data-scroll-target="#expected-frequencies">Expected frequencies</a></li>
  </ul></li>
  <li><a href="#outlier-significance" id="toc-outlier-significance" class="nav-link" data-scroll-target="#outlier-significance">Outlier significance</a>
  <ul class="collapse">
  <li><a href="#example-1-mileage-versus-car_size" id="toc-example-1-mileage-versus-car_size" class="nav-link" data-scroll-target="#example-1-mileage-versus-car_size">Example 1: mileage versus car_size</a></li>
  <li><a href="#specify-binning-per-interval-variable-2" id="toc-specify-binning-per-interval-variable-2" class="nav-link" data-scroll-target="#specify-binning-per-interval-variable-2">Specify binning per interval variable</a></li>
  <li><a href="#specify-binning-per-interval-variable-dealing-with-underflow-and-overflow" id="toc-specify-binning-per-interval-variable-dealing-with-underflow-and-overflow" class="nav-link" data-scroll-target="#specify-binning-per-interval-variable-dealing-with-underflow-and-overflow">Specify binning per interval variable – dealing with underflow and overflow</a></li>
  <li><a href="#dealing-with-nans-in-the-data" id="toc-dealing-with-nans-in-the-data" class="nav-link" data-scroll-target="#dealing-with-nans-in-the-data">Dealing with NaN’s in the data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Phi_K advanced tutorial</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This notebook guides you through the more advanced functionality of the phik package. This notebook will not cover all the underlying theory, but will just attempt to give an overview of all the options that are available. For a theoretical description the user is referred to our paper.</p>
<p>The package offers functionality on three related topics:</p>
<ol type="1">
<li>Phik correlation matrix</li>
<li>Significance matrix</li>
<li>Outlier significance matrix</li>
</ol>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install phik (if not installed yet)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="st">"</span><span class="sc">{sys.executable}</span><span class="st">"</span> <span class="op">-</span>m pip install phik</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import standard packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> phik</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik <span class="im">import</span> resources</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.binning <span class="im">import</span> bin_data</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.decorators <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.report <span class="im">import</span> plot_correlation_matrix</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if one changes something in the phik-package one can automatically reload the package or module</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-data" class="level1">
<h1>Load data</h1>
<p>A simulated dataset is part of the phik-package. The dataset concerns car insurance data. Load the dataset here:</p>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv( resources.fixture(<span class="st">'fake_insurance_data.csv.gz'</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>black</td>
<td>26.377219</td>
<td>suburbs</td>
<td>156806.288398</td>
<td>XXL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>black</td>
<td>58.976840</td>
<td>suburbs</td>
<td>74400.323559</td>
<td>XL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>multicolor</td>
<td>55.744988</td>
<td>downtown</td>
<td>267856.748015</td>
<td>XXL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>metalic</td>
<td>57.629139</td>
<td>downtown</td>
<td>259028.249060</td>
<td>XXL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>green</td>
<td>21.490637</td>
<td>downtown</td>
<td>110712.216080</td>
<td>XL</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="specify-bin-types" class="level2">
<h2 class="anchored" data-anchor-id="specify-bin-types">Specify bin types</h2>
<p>The phik-package offers a way to calculate correlations between variables of mixed types. Variable types can be inferred automatically although we recommend to variable types to be specified by the user.</p>
<p>Because interval type variables need to be binned in order to calculate phik and the significance, a list of interval variables is created.</p>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_types <span class="op">=</span> {<span class="st">'severity'</span>: <span class="st">'interval'</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">'driver_age'</span>:<span class="st">'interval'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'satisfaction'</span>:<span class="st">'ordinal'</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'mileage'</span>:<span class="st">'interval'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'car_size'</span>:<span class="st">'ordinal'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">'car_use'</span>:<span class="st">'ordinal'</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">'car_color'</span>:<span class="st">'categorical'</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">'area'</span>:<span class="st">'categorical'</span>}</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>interval_cols <span class="op">=</span> [col <span class="cf">for</span> col, v <span class="kw">in</span> data_types.items() <span class="cf">if</span> v<span class="op">==</span><span class="st">'interval'</span> <span class="kw">and</span> col <span class="kw">in</span> data.columns]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>interval_cols</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># interval_cols is used below</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>['driver_age', 'mileage']</code></pre>
</div>
</div>
</section>
</section>
<section id="phik-correlation-matrix" class="level1">
<h1>Phik correlation matrix</h1>
<p>Now let’s start calculating the correlation phik between pairs of variables.</p>
<p>Note that the original dataset is used as input, the binning of interval variables is done automatically.</p>
<div id="cell-11" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>phik_overview <span class="op">=</span> data.phik_matrix(interval_cols<span class="op">=</span>interval_cols)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>phik_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>1.000000</td>
<td>0.389671</td>
<td>0.590456</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>0.389671</td>
<td>1.000000</td>
<td>0.105506</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>0.590456</td>
<td>0.105506</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.768589</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.768589</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="specify-binning-per-interval-variable" class="level3">
<h3 class="anchored" data-anchor-id="specify-binning-per-interval-variable">Specify binning per interval variable</h3>
<p>Binning can be set per interval variable individually. One can set the number of bins, or specify a list of bin edges. Note that the measured phik correlation is dependent on the chosen binning. The default binning is uniform between the min and max values of the interval variable.</p>
<div id="cell-13" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> {<span class="st">'mileage'</span>:<span class="dv">5</span>, <span class="st">'driver_age'</span>:[<span class="dv">18</span>,<span class="dv">25</span>,<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">55</span>,<span class="dv">65</span>,<span class="dv">125</span>]}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>phik_overview <span class="op">=</span> data.phik_matrix(interval_cols<span class="op">=</span>interval_cols, bins<span class="op">=</span>bins)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>phik_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>1.000000</td>
<td>0.388350</td>
<td>0.590456</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>0.388350</td>
<td>1.000000</td>
<td>0.071189</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>0.590456</td>
<td>0.071189</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.665845</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.665845</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="do-not-apply-noise-correction" class="level3">
<h3 class="anchored" data-anchor-id="do-not-apply-noise-correction">Do not apply noise correction</h3>
<p>For low statistics samples often a correlation larger than zero is measured when no correlation is actually present in the true underlying distribution. This is not only the case for phik, but also for the pearson correlation and Cramer’s phi (see figure 4 in <font color="red"> XX </font>). In the phik calculation a noise correction is applied by default, to take into account erroneous correlation values as a result of low statistics. To switch off this noise cancellation (not recommended), do:</p>
<div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>phik_overview <span class="op">=</span> data.phik_matrix(interval_cols<span class="op">=</span>interval_cols, noise_correction<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>phik_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>1.000000</td>
<td>0.407860</td>
<td>0.594172</td>
<td>0.136267</td>
<td>0.096629</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>0.407860</td>
<td>1.000000</td>
<td>0.190390</td>
<td>0.199606</td>
<td>0.121585</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>0.594172</td>
<td>0.190390</td>
<td>1.000000</td>
<td>0.149679</td>
<td>0.067452</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>0.136267</td>
<td>0.199606</td>
<td>0.149679</td>
<td>1.000000</td>
<td>0.770836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>0.096629</td>
<td>0.121585</td>
<td>0.067452</td>
<td>0.770836</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="using-a-different-expectation-histogram" class="level3">
<h3 class="anchored" data-anchor-id="using-a-different-expectation-histogram">Using a different expectation histogram</h3>
<p>By default phik compares the 2d distribution of two (binned) variables with the distribution that assumes no dependency between them. One can also change the expected distribution though. Phi_K is calculated in the same way, but using the other expectation distribution.</p>
<div id="cell-17" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.binning <span class="im">import</span> auto_bin_data</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.phik <span class="im">import</span> phik_observed_vs_expected_from_rebinned_df, phik_from_hist2d</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.statistics <span class="im">import</span> get_dependent_frequency_estimates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get observed 2d histogram of two variables</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">"mileage"</span>, <span class="st">"car_size"</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>icols <span class="op">=</span> [<span class="st">"mileage"</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>observed <span class="op">=</span> data[cols].hist2d(interval_cols<span class="op">=</span>icols).values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-19" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default phik evaluation from observed distribution</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>phik_value <span class="op">=</span> phik_from_hist2d(observed)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (phik_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.768588829489185</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># phik evaluation from an observed and expected distribution</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>expected <span class="op">=</span> get_dependent_frequency_estimates(observed)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>phik_value <span class="op">=</span> phik_from_hist2d(observed<span class="op">=</span>observed, expected<span class="op">=</span>expected)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (phik_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.768588829489185</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># one can also compare two datasets against each other, and get a full phik matrix that way.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this needs binned datasets though. </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (the user needs to make sure the binnings of both datasets are identical.) </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>data_binned, _ <span class="op">=</span> auto_bin_data(data, interval_cols<span class="op">=</span>interval_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we are comparing data_binned against itself</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>phik_matrix <span class="op">=</span> phik_observed_vs_expected_from_rebinned_df(data_binned, data_binned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all off-diagonal entries are zero, meaning the all 2d distributions of both datasets are identical.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (by construction the diagonal is one.)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>phik_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="statistical-significance-of-the-correlation" class="level1">
<h1>Statistical significance of the correlation</h1>
<p>When assessing correlations it is good practise to evaluate both the correlation and the significance of the correlation: a large correlation may be statistically insignificant, and vice versa a small correlation may be very significant. For instance, scipy.stats.pearsonr returns both the pearson correlation and the p-value. Similarly, the phik package offers functionality the calculate a significance matrix. Significance is defined as:</p>
<p><span class="math display">\[Z = \Phi^{-1}(1-p)\ ;\quad \Phi(z)=\frac{1}{\sqrt{2\pi}} \int_{-\infty}^{z} e^{-t^{2}/2}\,{\rm d}t \]</span></p>
<p>Several corrections to the ‘standard’ p-value calculation are taken into account, making the method more robust for low statistics and sparse data cases. The user is referred to our paper for more details.</p>
<p>Due to the corrections, the significance calculation can take a few seconds.</p>
<div id="cell-25" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>significance_overview <span class="op">=</span> data.significance_matrix(interval_cols<span class="op">=</span>interval_cols)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>significance_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>85.498655</td>
<td>19.836720</td>
<td>37.623764</td>
<td>-0.559532</td>
<td>-0.483387</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>19.836720</td>
<td>84.370542</td>
<td>1.852524</td>
<td>-0.572284</td>
<td>-0.459980</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>37.623764</td>
<td>1.852524</td>
<td>72.415600</td>
<td>-0.560672</td>
<td>-0.273138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>-0.559532</td>
<td>-0.572284</td>
<td>-0.560672</td>
<td>91.262677</td>
<td>49.285368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>-0.483387</td>
<td>-0.459980</td>
<td>-0.273138</td>
<td>49.285368</td>
<td>69.064056</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="specify-binning-per-interval-variable-1" class="level3">
<h3 class="anchored" data-anchor-id="specify-binning-per-interval-variable-1">Specify binning per interval variable</h3>
<p>Binning can be set per interval variable individually. One can set the number of bins, or specify a list of bin edges. Note that the measure phik correlation is dependent on the chosen binning.</p>
<div id="cell-27" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> {<span class="st">'mileage'</span>:<span class="dv">5</span>, <span class="st">'driver_age'</span>:[<span class="dv">18</span>,<span class="dv">25</span>,<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">55</span>,<span class="dv">65</span>,<span class="dv">125</span>]}</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>significance_overview <span class="op">=</span> data.significance_matrix(interval_cols<span class="op">=</span>interval_cols, bins<span class="op">=</span>bins)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>significance_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>85.480870</td>
<td>20.544400</td>
<td>37.613135</td>
<td>-0.214896</td>
<td>-0.447747</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>20.544400</td>
<td>83.344168</td>
<td>2.478032</td>
<td>-0.563892</td>
<td>-0.534263</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>37.613135</td>
<td>2.478032</td>
<td>72.428355</td>
<td>-0.309349</td>
<td>-0.260994</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>-0.214896</td>
<td>-0.563892</td>
<td>-0.309349</td>
<td>77.784086</td>
<td>47.010736</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>-0.447747</td>
<td>-0.534263</td>
<td>-0.260994</td>
<td>47.010736</td>
<td>69.081712</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="specify-significance-method" class="level3">
<h3 class="anchored" data-anchor-id="specify-significance-method">Specify significance method</h3>
<p>The recommended method to calculate the significance of the correlation is a hybrid approach, which uses the G-test statistic. The number of degrees of freedom and an analytical, empirical description of the <span class="math inline">\(\chi^2\)</span> distribution are sed, based on Monte Carlo simulations. This method works well for both high as low statistics samples.</p>
<p>Other approaches to calculate the significance are implemented: - asymptotic: fast, but over-estimates the number of degrees of freedom for low statistics samples, leading to erroneous values of the significance - MC: Many simulated samples are needed to accurately measure significances larger than 3, making this method computationally expensive.</p>
<div id="cell-29" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>significance_overview <span class="op">=</span> data.significance_matrix(interval_cols<span class="op">=</span>interval_cols, significance_method<span class="op">=</span><span class="st">'asymptotic'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>significance_overview</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">car_color</th>
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">mileage</th>
<th data-quarto-table-cell-role="th">car_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_color</td>
<td>85.526574</td>
<td>19.681564</td>
<td>37.661844</td>
<td>-0.385023</td>
<td>-0.333340</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">driver_age</td>
<td>19.681564</td>
<td>84.014654</td>
<td>1.742050</td>
<td>-0.947153</td>
<td>-0.793434</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">area</td>
<td>37.661844</td>
<td>1.742050</td>
<td>72.440209</td>
<td>-0.465002</td>
<td>-0.123678</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mileage</td>
<td>-0.385023</td>
<td>-0.947153</td>
<td>-0.465002</td>
<td>91.301129</td>
<td>49.332305</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">car_size</td>
<td>-0.333340</td>
<td>-0.793434</td>
<td>-0.123678</td>
<td>49.332305</td>
<td>69.107448</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="simulation-method" class="level3">
<h3 class="anchored" data-anchor-id="simulation-method">Simulation method</h3>
<p>The chi2 of a contingency table is measured using a comparison of the expected frequencies with the true frequencies in a contingency table. The expected frequencies can be simulated in a variety of ways. The following methods are implemented:</p>
<ul>
<li>multinominal: Only the total number of records is fixed. (default)</li>
<li>row_product_multinominal: The row totals fixed in the sampling.</li>
<li>col_product_multinominal: The column totals fixed in the sampling.</li>
<li>hypergeometric: Both the row or column totals are fixed in the sampling. (Note that this type of sampling is only available when row and column totals are integers, which is usually the case.)</li>
</ul>
<div id="cell-31" class="cell" data-scrolled="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Warning, can be slow</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     turned off here by default for unit testing purposes</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#significance_overview = data.significance_matrix(interval_cols=interval_cols, simulation_method='hypergeometric')</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#significance_overview</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="expected-frequencies" class="level3">
<h3 class="anchored" data-anchor-id="expected-frequencies">Expected frequencies</h3>
<div id="cell-33" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> phik.simulation <span class="im">import</span> sim_2d_data_patefield, sim_2d_product_multinominal, sim_2d_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>inputdata <span class="op">=</span> data[[<span class="st">'driver_age'</span>, <span class="st">'area'</span>]].hist2d(interval_cols<span class="op">=</span>[<span class="st">'driver_age'</span>])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>inputdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">area</th>
<th data-quarto-table-cell-role="th">country_side</th>
<th data-quarto-table-cell-role="th">downtown</th>
<th data-quarto-table-cell-role="th">hills</th>
<th data-quarto-table-cell-role="th">suburbs</th>
<th data-quarto-table-cell-role="th">unpaved_roads</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">driver_age</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>11.0</td>
<td>86.0</td>
<td>123.0</td>
<td>147.0</td>
<td>21.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>9.0</td>
<td>77.0</td>
<td>137.0</td>
<td>125.0</td>
<td>31.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>7.0</td>
<td>102.0</td>
<td>131.0</td>
<td>130.0</td>
<td>18.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>17.0</td>
<td>83.0</td>
<td>130.0</td>
<td>95.0</td>
<td>14.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>13.0</td>
<td>68.0</td>
<td>120.0</td>
<td>72.0</td>
<td>8.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>7.0</td>
<td>30.0</td>
<td>51.0</td>
<td>47.0</td>
<td>9.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1.0</td>
<td>11.0</td>
<td>23.0</td>
<td>14.0</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.0</td>
<td>4.0</td>
<td>7.0</td>
<td>8.0</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="multinominal" class="level4">
<h4 class="anchored" data-anchor-id="multinominal">Multinominal</h4>
<div id="cell-36" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>simdata <span class="op">=</span> sim_2d_data(inputdata.values)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data total:'</span>, inputdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  total:'</span>, simdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data row totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).values)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  row totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data column totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).values)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  column totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data total: 2000.0
sim  total: 2000
data row totals: [ 65. 462. 724. 639. 110.]
sim  row totals: [ 75 468 748 586 123]
data column totals: [388. 379. 388. 339. 281. 144.  56.  21.   2.   2.]
sim  column totals: [378 380 375 335 281 164  59  25   1   2]</code></pre>
</div>
</div>
</section>
<section id="product-multinominal" class="level4">
<h4 class="anchored" data-anchor-id="product-multinominal">product multinominal</h4>
<div id="cell-38" class="cell" data-scrolled="false" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>simdata <span class="op">=</span> sim_2d_product_multinominal(inputdata.values, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data total:'</span>, inputdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  total:'</span>, simdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data row totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).astype(<span class="bu">int</span>).values)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  row totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).astype(<span class="bu">int</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'data column totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">int</span>).values)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sim  column totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">int</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data total: 2000.0
sim  total: 2000
data row totals: [ 65 462 724 639 110]
sim  row totals: [ 65 462 724 639 110]
data column totals: [388 379 388 339 281 144  56  21   2   2]
sim  column totals: [399 353 415 349 272 139  45  22   4   2]</code></pre>
</div>
</div>
</section>
<section id="hypergeometric-patefield" class="level4">
<h4 class="anchored" data-anchor-id="hypergeometric-patefield">hypergeometric (“patefield”)</h4>
<div id="cell-40" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># patefield simulation needs compiled c++ code.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># only run this if the python binding to the (compiled) patefiled simulation function is found.</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> phik.simcore <span class="im">import</span> _sim_2d_data_patefield</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    CPP_SUPPORT <span class="op">=</span> <span class="va">True</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    CPP_SUPPORT <span class="op">=</span> <span class="va">False</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> CPP_SUPPORT:</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    simdata <span class="op">=</span> sim_2d_data_patefield(inputdata.values)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'data total:'</span>, inputdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'sim  total:'</span>, simdata.<span class="bu">sum</span>().<span class="bu">sum</span>())</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'data row totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).astype(<span class="bu">int</span>).values)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'sim  row totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'data column totals:'</span>, inputdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">int</span>).values)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'sim  column totals:'</span>, simdata.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data total: 2000.0
sim  total: 2000
data row totals: [ 65 462 724 639 110]
sim  row totals: [ 65 462 724 639 110]
data column totals: [388 379 388 339 281 144  56  21   2   2]
sim  column totals: [388 379 388 339 281 144  56  21   2   2]</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="outlier-significance" class="level1">
<h1>Outlier significance</h1>
<p>The normal pearson correlation between two interval variables is easy to interpret. However, the phik correlation between two variables of mixed type is not always easy to interpret, especially when it concerns categorical variables. Therefore, functionality is provided to detect “outliers”: excesses and deficits over the expected frequencies in the contingency table of two variables.</p>
<section id="example-1-mileage-versus-car_size" class="level3">
<h3 class="anchored" data-anchor-id="example-1-mileage-versus-car_size">Example 1: mileage versus car_size</h3>
<p>For the categorical variable pair mileage - car_size we measured:</p>
<p><span class="math display">\[\phi_k = 0.77 \, ,\quad\quad \mathrm{significance} = 46.3\]</span></p>
<p>Let’s use the outlier significance functionality to gain a better understanding of this significance correlation between mileage and car size.</p>
<div id="cell-44" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>c0 <span class="op">=</span> <span class="st">'mileage'</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>c1 <span class="op">=</span> <span class="st">'car_size'</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>tmp_interval_cols <span class="op">=</span> [<span class="st">'mileage'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>outlier_signifs, binning_dict <span class="op">=</span> data[[c0,c1]].outlier_significance_matrix(interval_cols<span class="op">=</span>tmp_interval_cols, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                                                                          retbins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>outlier_signifs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">car_size</th>
<th data-quarto-table-cell-role="th">L</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">XL</th>
<th data-quarto-table-cell-role="th">XS</th>
<th data-quarto-table-cell-role="th">XXL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">53.5_30047.0</td>
<td>6.882155</td>
<td>21.483476</td>
<td>18.076204</td>
<td>-8.209536</td>
<td>10.820863</td>
<td>-22.423985</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30047.0_60040.5</td>
<td>20.034528</td>
<td>-0.251737</td>
<td>-3.408409</td>
<td>2.534277</td>
<td>-1.973628</td>
<td>-8.209536</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60040.5_90033.9</td>
<td>1.627610</td>
<td>-3.043497</td>
<td>-2.265809</td>
<td>10.215936</td>
<td>-1.246784</td>
<td>-8.209536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">90033.9_120027.4</td>
<td>-3.711579</td>
<td>-3.827278</td>
<td>-2.885475</td>
<td>12.999048</td>
<td>-1.638288</td>
<td>-7.185622</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">120027.4_150020.9</td>
<td>-7.665861</td>
<td>-6.173001</td>
<td>-4.746762</td>
<td>9.629145</td>
<td>-2.841508</td>
<td>-0.504521</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">150020.9_180014.4</td>
<td>-7.533189</td>
<td>-6.063786</td>
<td>-4.660049</td>
<td>1.559370</td>
<td>-2.785049</td>
<td>6.765549</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">180014.4_210007.8</td>
<td>-5.541940</td>
<td>-4.425929</td>
<td>-3.360023</td>
<td>-4.802787</td>
<td>-1.942469</td>
<td>10.520540</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">210007.8_240001.3</td>
<td>-3.496905</td>
<td>-2.745103</td>
<td>-2.030802</td>
<td>-5.850529</td>
<td>-1.100873</td>
<td>8.723925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">240001.3_269994.8</td>
<td>-5.275976</td>
<td>-4.207164</td>
<td>-3.186534</td>
<td>-8.616464</td>
<td>-1.830944</td>
<td>13.303101</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">269994.8_299988.2</td>
<td>-8.014016</td>
<td>-6.458253</td>
<td>-4.973240</td>
<td>-12.868389</td>
<td>-2.989055</td>
<td>20.992824</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="specify-binning-per-interval-variable-2" class="level3">
<h3 class="anchored" data-anchor-id="specify-binning-per-interval-variable-2">Specify binning per interval variable</h3>
<p>Binning can be set per interval variable individually. One can set the number of bins, or specify a list of bin edges.</p>
<p>Note: in case a bin is created without any records this bin will be automatically dropped in the phik and (outlier) significance calculations. However, in the outlier significance calculation this will currently lead to an error as the number of provided bin edges does not match the number of bins anymore.</p>
<div id="cell-47" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>,<span class="fl">1E2</span>, <span class="fl">1E3</span>, <span class="fl">1E4</span>, <span class="fl">1E5</span>, <span class="fl">1E6</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>outlier_signifs, binning_dict <span class="op">=</span> data[[c0,c1]].outlier_significance_matrix(interval_cols<span class="op">=</span>tmp_interval_cols, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                                                                          bins<span class="op">=</span>bins, retbins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>outlier_signifs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">car_size</th>
<th data-quarto-table-cell-role="th">L</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">XL</th>
<th data-quarto-table-cell-role="th">XS</th>
<th data-quarto-table-cell-role="th">XXL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.0_100.0</td>
<td>-0.223635</td>
<td>-0.153005</td>
<td>-0.096640</td>
<td>-0.504167</td>
<td>2.150837</td>
<td>-1.337308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">100.0_1000.0</td>
<td>-0.742899</td>
<td>-0.533211</td>
<td>2.164954</td>
<td>-1.469996</td>
<td>5.704340</td>
<td>-3.272689</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000.0_10000.0</td>
<td>-3.489668</td>
<td>3.499856</td>
<td>18.061724</td>
<td>-6.831062</td>
<td>11.617394</td>
<td>-13.063085</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10000.0_100000.0</td>
<td>25.086723</td>
<td>15.956527</td>
<td>-0.251877</td>
<td>5.162309</td>
<td>-3.896807</td>
<td>-8.209536</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">100000.0_1000000.0</td>
<td>-8.209536</td>
<td>-17.223164</td>
<td>-13.626621</td>
<td>-2.140870</td>
<td>-8.688844</td>
<td>44.933133</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="specify-binning-per-interval-variable-dealing-with-underflow-and-overflow" class="level3">
<h3 class="anchored" data-anchor-id="specify-binning-per-interval-variable-dealing-with-underflow-and-overflow">Specify binning per interval variable – dealing with underflow and overflow</h3>
<p>When specifying custom bins as situation can occur when the minimal (maximum) value in the data is smaller (larger) than the minimum (maximum) bin edge. Data points outside the specified range will be collected in the underflow (UF) and overflow (OF) bins. One can choose how to deal with these under/overflow bins, by setting the drop_underflow and drop_overflow variables.</p>
<p>Note that the drop_underflow and drop_overflow options are also available for the calculation of the phik matrix and the significance matrix.</p>
<div id="cell-49" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="fl">1E2</span>, <span class="fl">1E3</span>, <span class="fl">1E4</span>, <span class="fl">1E5</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>outlier_signifs, binning_dict <span class="op">=</span> data[[c0,c1]].outlier_significance_matrix(interval_cols<span class="op">=</span>tmp_interval_cols, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                                                          bins<span class="op">=</span>bins, retbins<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                                                                          drop_underflow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                                                                          drop_overflow<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>outlier_signifs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">car_size</th>
<th data-quarto-table-cell-role="th">L</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">XL</th>
<th data-quarto-table-cell-role="th">XS</th>
<th data-quarto-table-cell-role="th">XXL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">100.0_1000.0</td>
<td>-0.742899</td>
<td>-0.533211</td>
<td>2.164954</td>
<td>-1.469996</td>
<td>5.704340</td>
<td>-3.272689</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1000.0_10000.0</td>
<td>-3.489668</td>
<td>3.499856</td>
<td>18.061724</td>
<td>-6.831062</td>
<td>11.617394</td>
<td>-13.063085</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10000.0_100000.0</td>
<td>25.086723</td>
<td>15.956527</td>
<td>-0.251877</td>
<td>5.162309</td>
<td>-3.896807</td>
<td>-8.209536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">OF</td>
<td>-8.209536</td>
<td>-17.223164</td>
<td>-13.626621</td>
<td>-2.140870</td>
<td>-8.688844</td>
<td>44.933133</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">UF</td>
<td>-0.223635</td>
<td>-0.153005</td>
<td>-0.096640</td>
<td>-0.504167</td>
<td>2.150837</td>
<td>-1.337308</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dealing-with-nans-in-the-data" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-nans-in-the-data">Dealing with NaN’s in the data</h3>
<p>Let’s add some missing values to our data</p>
<div id="cell-52" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data.loc[np.random.choice(<span class="bu">range</span>(<span class="bu">len</span>(data)), size<span class="op">=</span><span class="dv">10</span>), <span class="st">'car_size'</span>] <span class="op">=</span> np.nan</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data.loc[np.random.choice(<span class="bu">range</span>(<span class="bu">len</span>(data)), size<span class="op">=</span><span class="dv">10</span>), <span class="st">'mileage'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sometimes there can be information in the missing values and in which case you might want to consider the NaN values as a separate category. This can be achieved by setting the dropna argument to False.</p>
<div id="cell-54" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="fl">1E2</span>, <span class="fl">1E3</span>, <span class="fl">1E4</span>, <span class="fl">1E5</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>outlier_signifs, binning_dict <span class="op">=</span> data[[c0,c1]].outlier_significance_matrix(interval_cols<span class="op">=</span>tmp_interval_cols, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                                                          bins<span class="op">=</span>bins, retbins<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                                                                          drop_underflow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                                                                          drop_overflow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                                                                          dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>outlier_signifs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">car_size</th>
<th data-quarto-table-cell-role="th">L</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">NaN</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">XL</th>
<th data-quarto-table-cell-role="th">XS</th>
<th data-quarto-table-cell-role="th">XXL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">100.0_1000.0</td>
<td>-0.742899</td>
<td>-0.533211</td>
<td>-0.053620</td>
<td>2.185319</td>
<td>-1.467322</td>
<td>5.704340</td>
<td>-3.254118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1000.0_10000.0</td>
<td>-3.489668</td>
<td>3.499856</td>
<td>1.632438</td>
<td>17.591610</td>
<td>-6.821511</td>
<td>11.617394</td>
<td>-13.000691</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10000.0_100000.0</td>
<td>24.909164</td>
<td>15.798682</td>
<td>-1.078812</td>
<td>-0.081242</td>
<td>4.943028</td>
<td>-3.875525</td>
<td>-8.209536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">NaN</td>
<td>0.132649</td>
<td>0.488424</td>
<td>-0.073439</td>
<td>-0.455333</td>
<td>-0.132365</td>
<td>-0.211155</td>
<td>-0.012896</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OF</td>
<td>-8.209536</td>
<td>-17.158980</td>
<td>-0.283391</td>
<td>-13.396642</td>
<td>-1.909226</td>
<td>-8.651800</td>
<td>43.560131</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">UF</td>
<td>-0.223635</td>
<td>-0.153005</td>
<td>-0.013130</td>
<td>-0.094218</td>
<td>-0.503051</td>
<td>2.150837</td>
<td>-1.328194</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here OF and UF are the underflow and overflow bin of car_size, respectively.</p>
<p>To just ignore records with missing values set dropna to True (default).</p>
<div id="cell-56" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="fl">1E2</span>, <span class="fl">1E3</span>, <span class="fl">1E4</span>, <span class="fl">1E5</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>outlier_signifs, binning_dict <span class="op">=</span> data[[c0,c1]].outlier_significance_matrix(interval_cols<span class="op">=</span>tmp_interval_cols, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                                                          bins<span class="op">=</span>bins, retbins<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                                                          drop_underflow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                                                          drop_overflow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                                                          dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>outlier_signifs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">car_size</th>
<th data-quarto-table-cell-role="th">L</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">XL</th>
<th data-quarto-table-cell-role="th">XS</th>
<th data-quarto-table-cell-role="th">XXL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">100.0_1000.0</td>
<td>-0.745805</td>
<td>-0.534179</td>
<td>2.177522</td>
<td>-1.473602</td>
<td>5.695755</td>
<td>-3.268662</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1000.0_10000.0</td>
<td>-3.451793</td>
<td>3.559705</td>
<td>17.674546</td>
<td>-6.770807</td>
<td>11.651568</td>
<td>-12.916946</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10000.0_100000.0</td>
<td>25.035896</td>
<td>15.868135</td>
<td>-0.121191</td>
<td>4.904070</td>
<td>-3.896177</td>
<td>-8.209536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">OF</td>
<td>-8.209536</td>
<td>-17.164792</td>
<td>-13.459625</td>
<td>-1.934622</td>
<td>-8.695547</td>
<td>44.449479</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">UF</td>
<td>-0.224643</td>
<td>-0.153312</td>
<td>-0.095154</td>
<td>-0.505661</td>
<td>2.146765</td>
<td>-1.335316</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that the dropna option is also available for the calculation of the phik matrix and the significance matrix.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>